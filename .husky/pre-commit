#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run linting with auto-fix before commit
echo "ğŸ” Running pre-commit checks..."

# Frontend linting
if git diff --cached --name-only | grep -q "frontend/.*\.\(ts\|tsx\|js\|jsx\)$"; then
  echo "ğŸ“¦ Checking frontend code..."
  cd frontend
  
  # Run ESLint with auto-fix
  yarn eslint . --fix --ext .ts,.tsx,.js,.jsx
  
  # Run TypeScript check
  yarn tsc --noEmit
  
  # Add any fixed files back to staging
  git add -u
  
  cd ..
fi

# Backend linting
if git diff --cached --name-only | grep -q "backend/.*\.py$"; then
  echo "ğŸ Checking backend code..."
  cd backend
  
  # Run ruff with auto-fix
  poetry run ruff check . --fix
  poetry run ruff format .
  
  # Add any fixed files back to staging
  git add -u
  
  cd ..
fi

echo "âœ… Pre-commit checks complete!"